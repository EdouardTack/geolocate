"use strict";var GeolocateLang={},Geolocate=function(e){"undefined"==typeof jQuery&&console.error("Geolocate needs jQuery");var o={lang:"fr",cookie:{timeout:33696e6,name:{choice:"GeolocateChoice",latlng:"GeolocateLatLng"}},google:{key:"",url:"https://www.googleapis.com/geolocation/v1/geolocate"},box:{close:!0,timeout:550,template:'<div id="geolocate-wrapper">[[geolocate-close]]<div class="geolocate-host">[[geolocate-host]]</div><div class="geolocate-question">[[geolocate-localisation]]</div><div class="geolocate-buttons"><button class="geolocate-button geolocate-accept" id="geolocate-accept" type="button">[[geolocate-accept]]</button><button class="geolocate-button geolocate-decline" id="geolocate-decline" type="button">[[geolocate-decline]]</button></div></div>',legalTemplate:'<div id="geolocate-legal-wrapper"><div class="geolocate-message">[[geolocate-message]]</div><div class="geolocate-buttons"><button class="geolocate-button geolocate-accept" id="geolocate-message-accept" type="button">[[geolocate-accept]]</button><button class="geolocate-button geolocate-decline" id="geolocate-message-decline" type="button">[[geolocate-decline]]</button></div></div>'},callbacks:{beforeSend:function(){geolocate.loading()},success:function(e){setTimeout(function(){geolocate.unLoading(),geolocate.closeBox()},1250)},error:function(e,o,t,c){c.unLoading(),alert(GeolocateLang[c.settings.lang].error)},decline:function(){geolocate.closeBox()}}},t=o.google.url;this.settings=$.extend(o,e),e.google.key&&(this.settings.google.url=t+"?key="+e.google.key),this.initialize(),this.buttonsAction()};Geolocate.prototype={initialize:function(){if(!this.hasConfirmChoice()){var e=["[[geolocate-host]]","[[geolocate-localisation]]","[[geolocate-accept]]","[[geolocate-decline]]","[[geolocate-close]]"],o=[window.location.host,GeolocateLang[this.settings.lang].localisation,GeolocateLang[this.settings.lang].accept,GeolocateLang[this.settings.lang].decline,this.settings.box.close?'<div id="geolocate-close">&times;</div>':""];$("body").append(this.assignTemplate(this.settings.box.template,e,o)),this.settings.box.wrapper=$("#geolocate-wrapper"),this.displayBox()}},displayBox:function(){var e=this;"function"==typeof e.settings.callbacks.displayBox?e.settings.callbacks.displayBox(e.settings.box.wrapper):setTimeout(function(){e.settings.box.wrapper.animate({top:"15px",opacity:1},{duration:750})},e.settings.box.timeout)},closeBox:function(){"function"==typeof this.settings.callbacks.closeBox?this.settings.callbacks.closeBox(this.settings.box.wrapper):"undefined"!=typeof this.settings.box.wrapper&&this.settings.box.wrapper.animate({top:"-250px",opacity:0},{duration:350,complete:function(){this.settings.box.wrapper.remove()}})},loading:function(){"function"==typeof this.settings.callbacks.loading?this.settings.callbacks.loading():$("#geolocate-accept, #geolocate-message-accept, #geolocate-decline, #geolocate-message-decline").prop("disabled",!0).addClass("geolocate-loader")},unLoading:function(){"function"==typeof this.settings.callbacks.unLoading?this.settings.callbacks.unLoading():$("#geolocate-accept, #geolocate-message-accept, #geolocate-decline, #geolocate-message-decline").prop("disabled",!1).removeClass("geolocate-loader")},buttonsAction:function(){this.settings.google.coord={};var e=this;$("body").on("click","#geolocate-accept",function(){e._accept()}),$("body").on("click","#geolocate-decline",function(){e._decline()}),$("body").on("click","#geolocate-close",function(){e.closeBox()})},_accept:function(){var e=this;$.ajax({url:e.settings.google.url,method:"POST",dataType:"json",beforeSend:function(){e.settings.callbacks.beforeSend()},success:function(o){e.deleteCookie(e.settings.cookie.name.choice),e.setCookie(e.settings.cookie.name.choice,"accept"),e.settings.google.coord.accuracy=o.accuracy,e.settings.google.coord.lat=o.location.lat,e.settings.google.coord.lng=o.location.lng,e.deleteCookie(e.settings.cookie.name.latlng),e.setCookie(e.settings.cookie.name.latlng,e.settings.google.coord.lat+","+e.settings.google.coord.lng),e.settings.callbacks.success(e.settings.google.coord)},error:function(o,t,c){e.settings.callbacks.error(o,t,c,e)}})},_decline:function(){var e=this;e.deleteCookie(e.settings.cookie.name.choice),e.setCookie(e.settings.cookie.name.choice,"decline"),e.settings.callbacks.decline()},update:function(e,o,t,c){var i=this;"accept"==i.getCookie("GeolocateChoice")?e.on("click",function(){$.ajax({url:i.settings.google.url,method:"POST",dataType:"json",beforeSend:function(){"function"==typeof t&&t(i)},success:function(e){i.settings.google.coord.accuracy=e.accuracy,i.settings.google.coord.lat=e.location.lat,i.settings.google.coord.lng=e.location.lng,i.deleteCookie(i.settings.cookie.name.latlng),i.setCookie(i.settings.cookie.name.latlng,i.settings.google.coord.lat+","+i.settings.google.coord.lng),"function"==typeof o&&o(i)},error:function(e,o,t){"function"==typeof c?c(e,o,t,i):i.settings.callbacks.error(e,o,t,i)}})}):e.hide()},hasConfirmChoice:function(){return document.cookie.indexOf(this.settings.cookie.name.choice+"=accept")>-1||document.cookie.indexOf(this.settings.cookie.name.choice+"=decline")>-1},getCookie:function(e){var e=e+"=",o=document.cookie.split(";"),t=0;for(t;t<o.length;t++){for(var c=o[t];" "==c.charAt(0);)c=c.substring(1);if(0==c.indexOf(e))return c.substring(e.length,c.length)}return""},setCookie:function(e,o){var t=new Date;t.setTime(t.getTime()+this.settings.cookie.timeout),document.cookie=e+"="+o+";expires="+t.toGMTString()+";path=/"},deleteCookie:function(e){document.cookie=e+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; path=/"},assignTemplate:function(e,o,t){for(var c=0;c<o.length;c++)e=e.replace(o[c],t[c]);return e},legal:function(e){if(e.length>0){var o=this,t="accept"==this.getCookie("GeolocateChoice")?GeolocateLang[this.settings.lang]["legal-accept-message"]:"decline"==this.getCookie("GeolocateChoice")?GeolocateLang[this.settings.lang]["legal-decline-message"]:"",c=this.getCookie("GeolocateChoice")?GeolocateLang[this.settings.lang]["legal-message"]:GeolocateLang[this.settings.lang].localisation,i=["[[geolocate-message]]","[[geolocate-accept]]","[[geolocate-decline]]"],a=['<div id="geolocate-cookie-choice">'+t+'</div><div id="geolocate-legal-message">'+c+"</div>",GeolocateLang[this.settings.lang]["legal-accept"],GeolocateLang[this.settings.lang]["legal-decline"]];e.append(this.assignTemplate(this.settings.box.legalTemplate,i,a)),e.on("click","#geolocate-message-accept",function(){o._accept(),$("#geolocate-cookie-choice").html(GeolocateLang[o.settings.lang]["legal-accept-message"])}),e.on("click","#geolocate-message-decline",function(){o.loading(),o._decline(),setTimeout(function(){o.unLoading(),$("#geolocate-cookie-choice").html(GeolocateLang[o.settings.lang]["legal-decline-message"])},850)})}}};